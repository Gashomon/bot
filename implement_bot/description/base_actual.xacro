<?xml version="1.0"?>
<!-- ROBOT CORE COMPONENTS-->
 <!-- ACTUAL -->
 
<!-- call xacro-->
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
    
    <!-- Properties xacro-->
    <xacro:include filename="base_properties.xacro"/>

    <!-- World link-joints -->
    <link name="base_link">
    </link>

    <link name="base_footprint">
    </link>
    
    <joint name="base_joint" type="fixed">
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>

    <!-- <link name="odom">
    </link>
    
    <joint name="base_odom" type="fixed">
        <parent link="base_footprint"/>
        <child link="odom"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint> -->

    <!-- Body link-joints -->
    <link name="chassis_link">
        <visual>
            <geometry>
                <mesh filename="package://bot/description/meshes/model-chassis_part.dae" scale="${scale}"/>
            </geometry>
            <xacro:scaled_origin x="0.0" y="0.0" z="0.0"/>
        </visual>
        <collision>
            <geometry>
                <mesh filename="package://bot/description/meshes/model-chassis_part.dae" scale="${scale}"/>
            </geometry>
            <xacro:scaled_origin x="0.0" y="0.0" z="0.0"/>
        </collision>
        <xacro:inertial_box mass="${chassis_mass}" x="${actual_bot_width}" y="${actual_bot_length}" z="${actual_chassis_height}">
            <!-- <origin xyz="0 0 0" rpy="0 0 0"/> -->
            <xacro:scaled_origin_rpy x="0" y="0"  z="0" roll="0" pitch="0" yaw="0"/>
        </xacro:inertial_box>
    </link>

    <joint name="chassis_joint" type="fixed">
        <parent link="base_link"/>
        <child link="chassis_link"/>
        <xacro:scaled_origin x="0.0" y="0.0" z="0.0"/>
    </joint>

    <!-- Wheel link-joints -->
    <xacro:macro name="wheel_link" params="pos_x pos_y">
        <link name="${pos_x}_${pos_y}_wheel_link">
            <visual>
                <geometry>
                    <mesh filename="package://bot/description/meshes/model-wheel_part_curve.dae" scale="${scale}"/>
                </geometry>
                <xacro:scaled_origin_rpy x="0" y="0"  z="0" roll="0" pitch="0" yaw="0"/>
            </visual>
            <collision>
                <geometry>
                    <mesh filename="package://bot/description/meshes/model-wheel_part_curve.dae" scale="${scale}"/>
                </geometry>
                <xacro:scaled_origin_rpy x="0" y="0"  z="0" roll="0" pitch="0" yaw="0"/>
            </collision>
            <xacro:inertial_cylinder mass="${wheel_mass}" length="${total_wheel_length}" radius="${actual_wheel_radius}">
                <!-- <origin xyz="0 0 0" rpy="0 0 0"/> -->
            <xacro:scaled_origin_rpy x="0" y="0"  z="0" roll="0" pitch="0" yaw="0"/>
            </xacro:inertial_cylinder>
        </link> 
    </xacro:macro>
    
    <xacro:wheel_link pos_x="left" pos_y="back"/>
    <xacro:wheel_link pos_x="right" pos_y="back"/>
    <xacro:wheel_link pos_x="left" pos_y="front"/>
    <xacro:wheel_link pos_x="right" pos_y="front"/>

    <xacro:macro name="wheel_joint" params="pos_x pos_y axis">
        <xacro:if value="${pos_x == 'left'}">
            <xacro:property name="wheel_x" value="10.0"/>
            <xacro:property name="wheel_turn" value="${left_roll}"/>
        </xacro:if>
        <xacro:if value="${pos_x == 'right'}">
            <xacro:property name="wheel_x" value="10.0"/>
            <xacro:property name="wheel_turn" value="${right_roll}"/>
        </xacro:if>
        <xacro:if value="${pos_y == 'back'}">
            <xacro:property name="wheel_y" value="10.0"/>
        </xacro:if>
        <xacro:if value="${pos_y == 'front'}">
            <xacro:property name="wheel_y" value="10.0"/>
        </xacro:if>
        <joint name="${pos_x}_${pos_y}_wheel_joint" type="continuous">
            <parent link="base_link"/>
            <child link="${pos_x}_${pos_y}_wheel_link"/>
            <origin xyz="${wheel_x} ${wheel_y} 0" rpy="${wheel_turn} 0 0"/>
            <xacro:scaled_origin_rpy x="${wheel_x}" y="${wheel_y}"  z="0" roll="${wheel_turn}" pitch="0" yaw="0"/>
            <axis xyz="0 0 ${axis}"/>
        </joint>
    </xacro:macro>
    
    <xacro:wheel_joint pos_x="left" pos_y="back" axis="1"/>
    <xacro:wheel_joint pos_x="right" pos_y="back" axis="-1"/>
    <xacro:wheel_joint pos_x="left" pos_y="front" axis="1"/>
    <xacro:wheel_joint pos_x="right" pos_y="front" axis="-1"/>

</robot>